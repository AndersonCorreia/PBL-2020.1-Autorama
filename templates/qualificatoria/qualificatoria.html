{% extends 'base.html' %}
{% block css %}
    <link rel="stylesheet" href="/static/css/timer.css"> 
{% endblock %}

{% block content %}
    <div class="row my-4">
        <div class="col-12 col-md-6">
            <h5>{% block title %}SESSÃO DE QUALIFICAÇÃO: {% endblock %}</h5>
        </div>
        <div class="col-12 col-md-6">
            <h5>Recorde do Circuito: {{circuito['recorde']}}</h5>
        </div>
        <div class="col-12 col-md-6">
            <h5>CLASSIFICAÇÃO</h5>
        </div>
        <div class="col-12 col-md-6">
            <h5>Autor: </h5>
        </div>
    </div>
    <h2 class="text-center mt-4"></h2>
    <table class="table table-striped table-responsive-md table-light col-12 p-0 m-0 my-3">
        <thead class="thead-dark">
          <tr>
            <th scope="col-2">POS</th>
            <th scope="col-2">COR</th>
            <th scope="col-4">PILOTO</th>
            <th scope="col-4">EQUIPE</th>
            <th scope="col-2">TEMPO DE VOLTA</th>
            <th scope="col-4">VOLTAS</th>
          </tr>
        </thead>
        {% for pos in qualificatoria %}
        <tbody>
            <tr>
                <th scope="row">{{pos['pos']}}</th>
                <td><div style="background-color: {{pos['cor_carro']}}; width: 6em; height: 1.5em; margin: 0; padding: 0;"></div></td>
                <td>{{pos['nome_piloto']}}</td>
                <td>{{pos['nome_equipe']}}</td>
                <td>{{pos['tempo_volta']}}</td>
                <td>{{pos['voltas']}}</td>
            </tr>
        </tbody>
        {% endfor %}
        
    </table>


{% endblock %}

{% block js %}
<script type="application/javascript">
    
    function iniciarThread(){
        $.getJSON("{{url_for('qualificatoriaThread')}}", function (data) {
            if(data.success){
                console.log( "thread iniciada com sucesso" );
            }
            else {
                console.log( "Possivelmente algum erro no inicio da thread" );
                console.log(data)
            }
        })
        .fail(function() {
            console.log( "error na solicitação ajax" );
        })
    }
    iniciarThread()
        
    const interval = setInterval(() => {
        
        $.getJSON("{{url_for('qualificatoria')}}", function (data) {
            if(!data.success){
                console.log("erro no retorno da tela");
            }
        })
        .fail(function() {
            console.log( "error na solicitação ajax" );
        })
    }, 1000);
</script>
{% endblock %}